# Quality of Service

## URL

```
frinx-openconfig-qos:/qos/classifiers/classifier/{{class_name}}
```

## OPENCONFIG YANG

```javascript
{
    "classifier": [
        {
            "name": "{{class_name}}",
            "config": {
                "name": "{{class_name}}"
            },
            "terms": {
                "term": [
                    {
                        "id": "{{term_name}}",
                        "config": {
                            "id": "{{term_name}}"
                        },
                        "conditions": {
                            "ipv4|6": {
                                "config": {
                                    "dscp": "{{term_c_dscp}}",
                                    "qos-grp": {{term_c_qos_grp}}, // augument
                                    "acl-ref": "{{term_c_acl_ref}}" // augument (refrence to acl)
                                }
                            },
                            "mpls": {
                                "config": {
                                    "traffic-class": "{{term_c_tc}}"
                                }
                            }
                        },
                        "actions": {
                            "config": {
                                "target-group": {{class_name}}
                            },
                            "remark": {
                                "config": {
                                    "set-dscp": {{term_s_dscp}},
                                    "set-qos-grp": {{term_s_qos_grp}}, // augument
                                    "set-mpls-tc": {{term_s_tc}}
                                }
                            }
                        }
                    }
                ]
            }
        }
    ]
}
```

## URL

```
frinx-openconfig-qos:qos/scheduler-policies/scheduler-policy/{{policy_name}}
```

## OPENCONFIG YANG


```javascript
{
    "scheduler-policy": [
        {
            "name": "{{policy_name}}",
            "config": {
                "name": "{{policy_name}}"
            }
            "schedulers": {
                "scheduler": [
                    {
                        "sequence": "{{scheduler_seq}}", //internal value to be autogenerated
                        "config": {
                            "sequence": "{{scheduler_seq}}",
                            "priority": "STRICT" //nothing for non-priority schedulers
                        },
                        "inputs": {
                            "input": [
                                {
                                    "id": "{{scheduler_input_id}}",
                                    "config": {
                                        "id": "{{scheduler_input_id}}",
                                        "queue": "{{class_name}}",
                                        "weight": "{{scheduler_priority_weight}}" //wrong endian in cisco
                                    }
                                }
                            ]
                        },
                        "one-rate-two-color": {
                            "config": {
                                "cir-pct": {{scheduler_cir_pct}},
                                "cir-pct-remaining": {{scheduler_cir_pct_rem}},
                                "queuing-behavior": {{scheduler_queue_type}}, // add "bandwidth" type via augument
                                "max-queue-depth-ms": {{scheduler_max_queue_depth_ms}} // augument max queue depth based on ms
                            }
                        }
                    }
                ]
            }
        }
    ]
}
```

## URL


```
frinx-openconfig-qos:qos/interfaces/interface/{{if_id}}
```

## OPENCONFIG YANG


```javascript
{
    "interface": [
        {
            "interface-id": "{{if_id}}",
            "config": {
                "interface-id": "{{if_id}}"
            }
            "input": {
                "scheduler-policy": {
                    "config": {
                        "name": "{{policy_name_input}}"
                    }
                }
            }
            "output": {
                "scheduler-policy": {
                    "config": {
                        "name": "{{policy_name_output}}"
                    }
                }
            }
        }
    ]
}
```


## OS Configuration Commands

### Cisco IOS XR 5.3.4

#### CLI

<pre>
class-map <match-any/match-all> {{class_name}}
    match qos-group {{term_c_qos_grp}}
    match mpls experimenta topmost {{term_c_tc}}
    match precedence {{term_c_dscp}} // transform prec from dscp or use match dscp instead
    match access-group ipv4|6 {{term_c_acl_ref}}
end-class-map

policy-map {{policy_name}}
 class {{class_name}}
  set qos-group {{term_s_qos_grp}}
  set mpls experimental topmost {{term_s_tc}}
  set precedence {{term_s_dscp}} // transform prec from dscp or use match dscp instead
</pre>

<pre>
interface {{if_id}}
 service-policy input {{policy_name_input}}
 service-policy output {{policy_name_output}}
</pre>

When /qos/scheduler-policies/scheduler-policy/schedulers/scheduler/config/priority = STRICT

<pre>
policy-map {{policy_name}}
 class {{class_name}}
  priority level {{scheduler_priority_weight}}
  police rate percent {{scheduler_cir_pct}}
  queue-limit {{scheduler_max_queue_depth_ms}} ms
</pre>

When /qos/scheduler-policies/scheduler-policy/schedulers/scheduler/config/priority != STRICT and /qos/scheduler-policies/scheduler-policy/schedulers/scheduler/one-rate-two-color/config/queuing-behavior = BANDWIDTH
<pre>
policy-map {{policy_name}}
 class {{class_name}}
  queue-limit {{scheduler_max_queue_depth_ms}} ms
  bandwidth percent {{scheduler_cir_pct}}
  bandwidth remaining percent {{scheduler_cir_pct_rem}}
</pre>

When /qos/scheduler-policies/scheduler-policy/schedulers/scheduler/config/priority != STRICT and /qos/scheduler-policies/scheduler-policy/schedulers/scheduler/one-rate-two-color/config/queuing-behavior = POLICE
<pre>
policy-map {{policy_name}}
 class {{class_name}}
  queue-limit {{scheduler_max_queue_depth_ms}} ms
  police rate percent {{scheduler_cir_pct}}
</pre>

When /qos/scheduler-policies/scheduler-policy/schedulers/scheduler/config/priority != STRICT and /qos/scheduler-policies/scheduler-policy/schedulers/scheduler/one-rate-two-color/config/queuing-behavior = SHAPE
<pre>
policy-map {{policy_name}}
 class {{class_name}}
  queue-limit {{scheduler_max_queue_depth_ms}} ms
  shape average percent {{scheduler_cir_pct}}
</pre>

##### Examples

Classifier / Remarking
```javascript
{
    "classifier": [
        {
            "name": "{{class_name}}",
            "config": {
                "name": "{{class_name}}"
            },
            "terms": {
                "term": [
                    {
                        "id": "{{term_name}}",
                        "config": {
                            "id": "{{term_name}}"
                        },
                        "conditions": {
                            "ipv4|6": {
                                "config": {
                                    "acl-ref": "{{term_c_acl_ref}}", // augument with refrence to acl
                                    "dscp": "{{term_c_dscp}}"
                                }
                            },
                            "mpls": {
                                "config": {
                                    "traffic-class": "{{term_c_tc}}"
                                }
                            }
                        },
                        "actions": {
                            "config": {
                                "target-group": {{class_name}}
                            },
                            "remark": {
                                "config": {
                                    "set-dscp": {{term_s_dscp}},
                                    "set-mpls-tc": {{term_s_tc}}
                                }
                            }
                        }
                    }
                ]
            }
        }
    ]
}
```

```javascript
{
    "scheduler-policy": [
        {
            "name": "{{policy_name}}",
            "config": {
                "name": "{{policy_name}}"
            }
            "schedulers": {
                "scheduler": [
                    {
                        "sequence": "{{scheduler_seq}}",
                        "config": {
                            "sequence": "{{scheduler_seq}}"
                        },
                        "inputs": {
                            "input": [
                                {
                                    "id": "{{class_name}}",
                                    "config": {
                                        "id": "{{class_name}}",
                                        "queue": "{{class_name}}"
                                    }
                                }
                            ]
                        }
                    }
                ]
            }
        }
    ]
}
```

<pre>
class-map <match-any/match-all> {{class_name}}
    match qos-group <0-512> // internal in device and openconfig
    match mpls experimenta topmost {{term_c_tc}}
    match precedence {{term_c_dscp}} // transform prec from dscp or use match dscp instead
    match access-group ipv4|6 {{term_c_acl_ref}}
end-class-map

policy-map {{policy_name}}
 class {{class_name}}
  set qos-group <0-31> // internal in device and openconfig
  set mpls experimental topmost {{term_s_tc}}
  set precedence {{term_s_dscp}} // transform prec from dscp or use match dscp instead
</pre>

Low-Latency Queueing with Strict Priority Queueing

```javascript
{
    "scheduler-policy": [
        {
            "name": "{{policy_name}}",
            "config": {
                "name": "{{policy_name}}"
            }
            "schedulers": {
                "scheduler": [
                    {
                        "sequence": "{{scheduler_seq}}",
                        "config": {
                            "sequence": "{{scheduler_seq}}",
                            "priority": "STRICT" //nothing for non-priority schedulers
                        },
                        "inputs": {
                            "input": [
                                {
                                    "id": "{{scheduler_input_id}}",
                                    "config": {
                                        "id": "{{scheduler_input_id}}",
                                        "queue": "{{class_name}}",
                                        "weight": "{{scheduler_priority_weight}}" //wrong endian in cisco ??
                                    }
                                }
                            ]
                        },
                        "one-rate-two-color": {
                            "config": {
                                "cir-pct": {{scheduler_cir_pct}},
                                "queuing-behavior": {{scheduler_queue_type}}, //
                                "max-queue-depth-ms": {{scheduler_max_queue_depth_ms}},
                            }
                        }
                    }
                ]
            }
        }
    ]
}
```


<pre>

policy-map {{policy_name}}
 class {{class_name}}
  priority level {{scheduler_priority_weight}}
  police rate percent {{scheduler_cir_pct}}
  queue-limit {{scheduler_max_queue_depth_ms}} ms
</pre>

Guaranteed and Remaining Bandwidths

```javascript
{
    "scheduler-policy": [
        {
            "name": "{{policy_name}}",
            "config": {
                "name": "{{policy_name}}"
            }
            "schedulers": {
                "scheduler": [
                    {
                        "sequence": "{{scheduler_seq}}",
                        "config": {
                            "sequence": "{{scheduler_seq}}",
                        },
                        "inputs": {
                            "input": [
                                {
                                    "id": "{{scheduler_input_id}}",
                                    "config": {
                                        "id": "{{scheduler_input_id}}",
                                        "queue": "{{class_name}}",
                                    }
                                }
                            ]
                        },
                        "one-rate-two-color": {
                            "config": {
                                "cir-pct": {{scheduler_cir_pct}},
                                "cir-pct-remaining": {{scheduler_cir_pct_rem}},
                                "queuing-behavior": {{scheduler_queue_type}}, //set to none for bandwidth / police for policer / shape for shaper
                                "max-queue-depth-ms": {{scheduler_max_queue_depth_ms}},
                            }
                        }
                    }
                ]
            }
        }
    ]
}
```


<pre>
policy-map {{policy_name}}
 class {{class_name}}
  queue-limit {{scheduler_max_queue_depth_ms}} ms
  bandwidth percent {{scheduler_cir_pct}}
  bandwidth remaining percent {{scheduler_cir_pct_rem}}
</pre>

Traffic Policing

```javascript
{
    "scheduler-policy": [
        {
            "name": "{{policy_name}}",
            "config": {
                "name": "{{policy_name}}"
            }
            "schedulers": {
                "scheduler": [
                    {
                        "sequence": "{{scheduler_seq}}",
                        "config": {
                            "sequence": "{{scheduler_seq}}",
                        },
                        "inputs": {
                            "input": [
                                {
                                    "id": "{{scheduler_input_id}}",
                                    "config": {
                                        "id": "{{scheduler_input_id}}",
                                        "queue": "{{class_name}}",
                                    }
                                }
                            ]
                        },
                        "one-rate-two-color": {
                            "config": {
                                "cir-pct": {{scheduler_cir_pct}},
                                "cir-pct-remaining": {{scheduler_cir_pct_rem}},
                                "queuing-behavior": {{scheduler_queue_type}}, //none for bandwidth / police for policer / shape for shaper
                                "max-queue-depth-ms": {{scheduler_max_queue_depth_ms}},
                            }
                        }
                    }
                ]
            }
        }
    ]
}
```
<pre>
policy-map {{policy_name}}
 class {{class_name}}
  queue-limit {{scheduler_max_queue_depth_ms}} ms
  police rate percent {{scheduler_cir_pct}}
</pre>

Traffic Shaping

```javascript
{
    "scheduler-policy": [
        {
            "name": "{{policy_name}}",
            "config": {
                "name": "{{policy_name}}"
            }
            "schedulers": {
                "scheduler": [
                    {
                        "sequence": "{{scheduler_seq}}",
                        "config": {
                            "sequence": "{{scheduler_seq}}",
                        },
                        "inputs": {
                            "input": [
                                {
                                    "id": "{{scheduler_input_id}}",
                                    "config": {
                                        "id": "{{scheduler_input_id}}",
                                        "queue": "{{class_name}}",
                                    }
                                }
                            ]
                        },
                        "one-rate-two-color": {
                            "config": {
                                "cir-pct": {{scheduler_cir_pct}},
                                "cir-pct-remaining": {{scheduler_cir_pct_rem}},
                                "queuing-behavior": {{scheduler_queue_type}}, //none for bandwidth / police for policer / shape for shaper
                                "max-queue-depth-ms": {{scheduler_max_queue_depth_ms}},
                            }
                        }
                    }
                ]
            }
        }
    ]
}
```
<pre>
policy-map {{policy_name}}
 class {{class_name}}
  queue-limit {{scheduler_max_queue_depth_ms}} ms
  shape average percent {{scheduler_cir_pct}}
</pre>
